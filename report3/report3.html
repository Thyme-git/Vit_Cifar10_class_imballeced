<!DOCTYPE html>
        <html>
        <head>
            <meta charset="UTF-8">
            <title>&#x6df1;&#x5ea6;&#x5b66;&#x4e60;&#x4e0e;&#x8ba1;&#x7b97;&#x673a;&#x89c6;&#x89c9;&#x5b9e;&#x9a8c;&#x4e09;&#xff1a; CIFAR-ViT</title>
            <style>
/* From extension vscode.github */
/*---------------------------------------------------------------------------------------------
 *  Copyright (c) Microsoft Corporation. All rights reserved.
 *  Licensed under the MIT License. See License.txt in the project root for license information.
 *--------------------------------------------------------------------------------------------*/

.vscode-dark img[src$=\#gh-light-mode-only],
.vscode-light img[src$=\#gh-dark-mode-only],
.vscode-high-contrast:not(.vscode-high-contrast-light) img[src$=\#gh-light-mode-only],
.vscode-high-contrast-light img[src$=\#gh-dark-mode-only] {
	display: none;
}

</style>
            <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex/dist/katex.min.css">
<link href="https://cdn.jsdelivr.net/npm/katex-copytex@latest/dist/katex-copytex.min.css" rel="stylesheet" type="text/css">
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/Microsoft/vscode/extensions/markdown-language-features/media/markdown.css">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/Microsoft/vscode/extensions/markdown-language-features/media/highlight.css">
<style>
            body {
                font-family: -apple-system, BlinkMacSystemFont, 'Segoe WPC', 'Segoe UI', system-ui, 'Ubuntu', 'Droid Sans', sans-serif;
                font-size: 14px;
                line-height: 1.6;
            }
        </style>
        <style>
.task-list-item {
    list-style-type: none;
}

.task-list-item-checkbox {
    margin-left: -20px;
    vertical-align: middle;
    pointer-events: none;
}
</style>
<style>
:root {
  --color-note: #0969da;
  --color-tip: #1a7f37;
  --color-warning: #9a6700;
  --color-severe: #bc4c00;
  --color-caution: #d1242f;
  --color-important: #8250df;
}

</style>
<style>
@media (prefers-color-scheme: dark) {
  :root {
    --color-note: #2f81f7;
    --color-tip: #3fb950;
    --color-warning: #d29922;
    --color-severe: #db6d28;
    --color-caution: #f85149;
    --color-important: #a371f7;
  }
}

</style>
<style>
.markdown-alert {
  padding: 0.5rem 1rem;
  margin-bottom: 16px;
  color: inherit;
  border-left: .25em solid #888;
}

.markdown-alert>:first-child {
  margin-top: 0
}

.markdown-alert>:last-child {
  margin-bottom: 0
}

.markdown-alert .markdown-alert-title {
  display: flex;
  font-weight: 500;
  align-items: center;
  line-height: 1
}

.markdown-alert .markdown-alert-title .octicon {
  margin-right: 0.5rem;
  display: inline-block;
  overflow: visible !important;
  vertical-align: text-bottom;
  fill: currentColor;
}

.markdown-alert.markdown-alert-note {
  border-left-color: var(--color-note);
}

.markdown-alert.markdown-alert-note .markdown-alert-title {
  color: var(--color-note);
}

.markdown-alert.markdown-alert-important {
  border-left-color: var(--color-important);
}

.markdown-alert.markdown-alert-important .markdown-alert-title {
  color: var(--color-important);
}

.markdown-alert.markdown-alert-warning {
  border-left-color: var(--color-warning);
}

.markdown-alert.markdown-alert-warning .markdown-alert-title {
  color: var(--color-warning);
}

.markdown-alert.markdown-alert-tip {
  border-left-color: var(--color-tip);
}

.markdown-alert.markdown-alert-tip .markdown-alert-title {
  color: var(--color-tip);
}

.markdown-alert.markdown-alert-caution {
  border-left-color: var(--color-caution);
}

.markdown-alert.markdown-alert-caution .markdown-alert-title {
  color: var(--color-caution);
}

</style>
        
        </head>
        <body class="vscode-body vscode-light">
            <h1 id="æ·±åº¦å­¦ä¹ ä¸è®¡ç®—æœºè§†è§‰å®éªŒä¸‰-cifar-vit">æ·±åº¦å­¦ä¹ ä¸è®¡ç®—æœºè§†è§‰å®éªŒä¸‰ï¼š CIFAR-ViT</h1>
<center>
<div class="is-size-5 publication-authors">
<span class="author-block">
  <b style="font-size: 20px;">å®æ¯“ä¼Ÿ</b><sup></sup>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span>
<span class="author-block">
  <b style="font-size: 20px;">æ¨è¿›å²³</b><sup>*</sup></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
<span class="author-block">
  <b style="font-size: 20px;">å¼ å­é™†</b><sup>*</sup>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span>
<span class="author-block">
  <b style="font-size: 20px;">å¼ åœ£æƒ</b><sup>*</sup>
</span>
</div>
</center>
<center>
<div>
<p style="font-size: 16px;"><sup>*</sup>è¡¨ç¤ºåŒç­‰è´¡çŒ®</p>
</div>
</center>
<blockquote>
<p>åˆ†å·¥ï¼š</p>
<ul>
<li>å®æ¯“ä¼Ÿ(U202115325)ï¼šå†™ä»£ç ã€åšå®éªŒã€å†™æŠ¥å‘Šã€‚</li>
<li>æ¨è¿›å²³(U202114049)ï¼šå†™ä¸€ç‚¹ä»£ç ã€‚</li>
<li>å¼ å­é™†(U202115070)ï¼šåšä¸€ç‚¹å®éªŒã€‚</li>
<li>å¼ åœ£æƒ(U202112179)ï¼šå†™ä¸€ç‚¹æŠ¥å‘Šã€‚</li>
</ul>
<p>å·¥ä½œé‡ä¸å¥½é‡åŒ–ï¼Œå› æ­¤ç¡®åˆ‡çš„ç»„å†…è´¡çŒ®æ¯”ä¾‹æ— æ³•ç»™å‡ºã€‚æœ›è€å¸ˆæµ·æ¶µã€‚</p>
</blockquote>
<h2 id="vision-transformerç½‘ç»œçš„ä»‹ç»ä¸å®ç°è¦æ±‚21å¿…åšéƒ¨åˆ†">Vision Transformerç½‘ç»œçš„ä»‹ç»ä¸å®ç°ï¼ˆè¦æ±‚2.1ï¼Œå¿…åšéƒ¨åˆ†ï¼‰</h2>
<blockquote>
<p>ç›¸å…³ä»£ç ä½äº <code>vit.py</code> æ–‡ä»¶ä¸­ã€‚</p>
</blockquote>
<p>Vision Transformer å…±åŒ…å«æœ‰ä»¥ä¸‹å‡ ä¸ªä¸»è¦æ¨¡å—ï¼š</p>
<ol>
<li>Multi-head Self-Attention (MSA)</li>
<li>Feed Forward Network (FFN)</li>
<li>Patch Embedding</li>
<li>Normalization Layer</li>
</ol>
<p>[ğŸ’¡]æœ¬æ–‡çš„å®ç°ä¸æ–‡ç«  <em>An Image is Worth 16x16 Words: Transformers for Image Recognition at Scale</em> ä¸­çš„å®ç°æœ‰æ‰€ä¸åŒï¼š</p>
<ol>
<li>æœ¬æ–‡å¹¶æœªä½¿ç”¨ Class token, è¿™ä¸€ç‚¹ä¸å…¶åŒæ—¶æœŸçš„å¦ä¸€ç¯‡æ–‡ç«  <em>Swin Transformer: Hierarchical Vision Transformer using Shifted Windows</em> ä¿æŒä¸€è‡´ã€‚</li>
<li>æœ¬æ–‡ä½¿ç”¨çš„Normalization Layeræ˜¯BatchNorm2dï¼Œè€Œä¸æ˜¯LayerNormã€‚</li>
</ol>
<p>åœ¨æœ¬ç« èŠ‚ä¸­ï¼Œæˆ‘ä¼šè¯¦ç»†ä»‹ç»è¿™å‡ ä¸ªæ¨¡å—çš„å®ç°ã€‚</p>
<h3 id="multi-head-self-attention-msa">Multi-head Self-Attention (MSA)</h3>
<p>Self-Attention æ˜¯ Transformer ä¸­çš„æ ¸å¿ƒæ¨¡å—ï¼Œå®ƒèƒ½å¤Ÿæ•æ‰è¾“å…¥åºåˆ—ä¸­ä¸åŒä½ç½®ä¹‹é—´çš„ä¾èµ–å…³ç³»ã€‚Attention çš„è®¡ç®—è¿‡ç¨‹å¦‚ä¸‹ï¼š</p>
<p class="katex-block"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mtext>Attention</mtext><mo stretchy="false">(</mo><mi>Q</mi><mo separator="true">,</mo><mi>K</mi><mo separator="true">,</mo><mi>V</mi><mo stretchy="false">)</mo><mo>=</mo><mtext>softmax</mtext><mrow><mo fence="true">(</mo><mfrac><mrow><mi>Q</mi><msup><mi>K</mi><mi>T</mi></msup></mrow><msqrt><msub><mi>d</mi><mi>k</mi></msub></msqrt></mfrac><mo fence="true">)</mo></mrow><mi>V</mi></mrow><annotation encoding="application/x-tex">\text{Attention}(Q, K, V) = \text{softmax}\left(\frac{QK^T}{\sqrt{d_k}}\right)V
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord text"><span class="mord">Attention</span></span><span class="mopen">(</span><span class="mord mathnormal">Q</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal" style="margin-right:0.07153em;">K</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal" style="margin-right:0.22222em;">V</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:2.4684em;vertical-align:-0.95em;"></span><span class="mord text"><span class="mord">softmax</span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="minner"><span class="mopen delimcenter" style="top:0em;"><span class="delimsizing size3">(</span></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.5183em;"><span style="top:-2.2528em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord sqrt"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8572em;"><span class="svg-align" style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord" style="padding-left:0.833em;"><span class="mord"><span class="mord mathnormal">d</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.03148em;">k</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span><span style="top:-2.8172em;"><span class="pstrut" style="height:3em;"></span><span class="hide-tail" style="min-width:0.853em;height:1.08em;"><svg xmlns="http://www.w3.org/2000/svg" width="400em" height="1.08em" viewBox="0 0 400000 1080" preserveAspectRatio="xMinYMin slice"><path d="M95,702
c-2.7,0,-7.17,-2.7,-13.5,-8c-5.8,-5.3,-9.5,-10,-9.5,-14
c0,-2,0.3,-3.3,1,-4c1.3,-2.7,23.83,-20.7,67.5,-54
c44.2,-33.3,65.8,-50.3,66.5,-51c1.3,-1.3,3,-2,5,-2c4.7,0,8.7,3.3,12,10
s173,378,173,378c0.7,0,35.3,-71,104,-213c68.7,-142,137.5,-285,206.5,-429
c69,-144,104.5,-217.7,106.5,-221
l0 -0
c5.3,-9.3,12,-14,20,-14
H400000v40H845.2724
s-225.272,467,-225.272,467s-235,486,-235,486c-2.7,4.7,-9,7,-19,7
c-6,0,-10,-1,-12,-3s-194,-422,-194,-422s-65,47,-65,47z
M834 80h400000v40h-400000z"/></svg></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.1828em;"><span></span></span></span></span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal">Q</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.07153em;">K</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8413em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.13889em;">T</span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.93em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mclose delimcenter" style="top:0em;"><span class="delimsizing size3">)</span></span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal" style="margin-right:0.22222em;">V</span></span></span></span></span></p>
<p>å…¶ä¸­ <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>Q</mi><mo separator="true">,</mo><mi>K</mi><mo separator="true">,</mo><mi>V</mi></mrow><annotation encoding="application/x-tex">Q, K, V</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8778em;vertical-align:-0.1944em;"></span><span class="mord mathnormal">Q</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal" style="margin-right:0.07153em;">K</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal" style="margin-right:0.22222em;">V</span></span></span></span> åˆ†åˆ«ä»£è¡¨ Query, Key, Valueï¼Œ<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>d</mi><mi>k</mi></msub></mrow><annotation encoding="application/x-tex">d_k</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8444em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">d</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.03148em;">k</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> ä»£è¡¨ Key çš„ç»´åº¦ã€‚åœ¨å®é™…åº”ç”¨ä¸­ï¼Œæˆ‘ä»¬é€šå¸¸ä¼šå°† <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>Q</mi><mo separator="true">,</mo><mi>K</mi><mo separator="true">,</mo><mi>V</mi></mrow><annotation encoding="application/x-tex">Q, K, V</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8778em;vertical-align:-0.1944em;"></span><span class="mord mathnormal">Q</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal" style="margin-right:0.07153em;">K</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal" style="margin-right:0.22222em;">V</span></span></span></span> åˆ†åˆ«é€šè¿‡çº¿æ€§å˜æ¢å¾—åˆ° <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mi>Q</mi><mo mathvariant="normal" lspace="0em" rspace="0em">â€²</mo></msup><mo separator="true">,</mo><msup><mi>K</mi><mo mathvariant="normal" lspace="0em" rspace="0em">â€²</mo></msup><mo separator="true">,</mo><msup><mi>V</mi><mo mathvariant="normal" lspace="0em" rspace="0em">â€²</mo></msup></mrow><annotation encoding="application/x-tex">Q&#x27;, K&#x27;, V&#x27;</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.9463em;vertical-align:-0.1944em;"></span><span class="mord"><span class="mord mathnormal">Q</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.7519em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">â€²</span></span></span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.07153em;">K</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.7519em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">â€²</span></span></span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.22222em;">V</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.7519em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">â€²</span></span></span></span></span></span></span></span></span></span></span></span>ï¼Œç„¶åå†è¿›è¡Œ Attention çš„è®¡ç®—ã€‚å¯¹äº Multi-head Self-Attentionï¼Œæˆ‘ä»¬ä¼šå°† <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>Q</mi><mo separator="true">,</mo><mi>K</mi><mo separator="true">,</mo><mi>V</mi></mrow><annotation encoding="application/x-tex">Q, K, V</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8778em;vertical-align:-0.1944em;"></span><span class="mord mathnormal">Q</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal" style="margin-right:0.07153em;">K</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal" style="margin-right:0.22222em;">V</span></span></span></span> åˆ†åˆ«é€šè¿‡ <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>h</mi></mrow><annotation encoding="application/x-tex">h</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord mathnormal">h</span></span></span></span> ä¸ªçº¿æ€§å˜æ¢å¾—åˆ° <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>Q</mi><mi>i</mi></msub><mo separator="true">,</mo><msub><mi>K</mi><mi>i</mi></msub><mo separator="true">,</mo><msub><mi>V</mi><mi>i</mi></msub></mrow><annotation encoding="application/x-tex">Q_i, K_i, V_i</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8778em;vertical-align:-0.1944em;"></span><span class="mord"><span class="mord mathnormal">Q</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.07153em;">K</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:-0.0715em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.22222em;">V</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:-0.2222em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>ï¼Œç„¶åå°† <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>h</mi></mrow><annotation encoding="application/x-tex">h</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord mathnormal">h</span></span></span></span> ä¸ª Attention çš„ç»“æœæ‹¼æ¥èµ·æ¥ï¼Œå†é€šè¿‡ä¸€ä¸ªçº¿æ€§å˜æ¢å¾—åˆ°æœ€ç»ˆçš„è¾“å‡ºã€‚</p>
<pre><code class="language-python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Attention</span>(nn.Module):
    <span class="hljs-string">&quot;&quot;&quot;
    Attention for images
    Input:
        - x: (B, C, H, W), already patched
    Output:
        - x: (B, C, H, W)
    &quot;&quot;&quot;</span>
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">
            self,
            in_channels: <span class="hljs-built_in">int</span>,
            num_heads: <span class="hljs-built_in">int</span>,
            dropout: <span class="hljs-built_in">float</span> = <span class="hljs-number">0.0</span>
        </span>):
        <span class="hljs-keyword">assert</span> in_channels % num_heads == <span class="hljs-number">0</span>, \
            <span class="hljs-string">f&quot;in_channels(got <span class="hljs-subst">{in_channels}</span>) must be divisible by num_heads(got <span class="hljs-subst">{num_heads}</span>)&quot;</span>

        <span class="hljs-built_in">super</span>().__init__()
        self.qkv_transform = nn.Conv2d(
            in_channels=in_channels,
            out_channels=in_channels * <span class="hljs-number">3</span>,
            kernel_size=<span class="hljs-number">1</span>,
            stride=<span class="hljs-number">1</span>,
            padding=<span class="hljs-number">0</span>,
            bias=<span class="hljs-literal">False</span>,
        )
        <span class="hljs-comment"># self.dropout = nn.Dropout(dropout)</span>
        self.dropout = dropout
        self.softmax = nn.Softmax(dim=-<span class="hljs-number">1</span>)
        self.num_heads = num_heads
        self.scale = in_channels ** -<span class="hljs-number">0.5</span>
    
        self._init_weights()
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">_init_weights</span>(<span class="hljs-params">self</span>):
        nn.init.xavier_uniform_(self.qkv_transform.weight)

    <span class="hljs-keyword">def</span> <span class="hljs-title function_">drop_attn</span>(<span class="hljs-params">self, attn</span>):
        B, h, N, _ = attn.shape
        mask = torch.rand((B, h, N, N), device=attn.device) &lt; self.dropout
        attn[mask] = <span class="hljs-built_in">float</span>(<span class="hljs-string">&#x27;-inf&#x27;</span>)
        <span class="hljs-keyword">return</span> attn

    <span class="hljs-keyword">def</span> <span class="hljs-title function_">forward</span>(<span class="hljs-params">self, x</span>):
        B, C, H, W = x.shape
        qkv = self.qkv_transform(x)
        q, k, v = torch.chunk(qkv, <span class="hljs-number">3</span>, dim=<span class="hljs-number">1</span>)
        q, k, v = <span class="hljs-built_in">map</span>(<span class="hljs-keyword">lambda</span> t: rearrange(t, <span class="hljs-string">&#x27;B (h d) H W -&gt; B h (H W) d&#x27;</span>, h=self.num_heads), (q, k, v))
        
        attn = (q @ k.transpose(-<span class="hljs-number">2</span>, -<span class="hljs-number">1</span>)) * self.scale <span class="hljs-comment"># (B, h, H*W, H*W)</span>
        attn = self.drop_attn(attn)
        x = self.softmax(attn) @ v
        x = rearrange(x, <span class="hljs-string">&#x27;B h (H W) d -&gt; B (h d) H W&#x27;</span>, H=H, W=W)
        <span class="hljs-keyword">return</span> x
</code></pre>
<blockquote>
<p>ä½¿ç”¨äº†å·ç§¯å®ç°Q K Vçš„çº¿æ€§å˜æ¢ã€‚</p>
</blockquote>
<h3 id="feed-forward-network-ffn">Feed Forward Network (FFN)</h3>
<p>Feed Forward Network å®é™…ä¸Šå°±æ˜¯ä¸€ä¸ªå¤šå±‚æ„ŸçŸ¥æœºï¼ˆMLPï¼‰ã€‚å®ƒå¯¹æ¯ä¸ªä½ç½®çš„ç‰¹å¾å‘é‡è¿›è¡Œç›¸åŒçš„å˜åŒ–ï¼Œå› æ­¤æ˜¯ä¸€ä¸ªfeature-wiseçš„æ“ä½œã€‚</p>
<pre><code class="language-python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">FFN</span>(nn.Module):
    <span class="hljs-string">&quot;&quot;&quot;
    Feed Forward Network for images
    Input:
        - x: (B, C, H, W)
    Output:
        - x: (B, C, H, W)
    &quot;&quot;&quot;</span>
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">
            self,
            in_channels: <span class="hljs-built_in">int</span>,
            hidden_channels: <span class="hljs-built_in">int</span>,
            dropout: <span class="hljs-built_in">float</span> = <span class="hljs-number">0.0</span>
        </span>):
        <span class="hljs-built_in">super</span>().__init__()
        self.ffn = nn.Sequential(
            nn.Conv2d(in_channels, hidden_channels, kernel_size=<span class="hljs-number">1</span>),
            nn.GELU(),
            nn.Dropout(dropout),

            nn.Conv2d(hidden_channels, in_channels, kernel_size=<span class="hljs-number">1</span>),
            nn.Dropout(dropout),
        )
    
        self._init_weights()
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">_init_weights</span>(<span class="hljs-params">self</span>):
        <span class="hljs-keyword">for</span> m <span class="hljs-keyword">in</span> self.modules():
            <span class="hljs-keyword">if</span> <span class="hljs-built_in">isinstance</span>(m, nn.Conv2d):
                nn.init.xavier_uniform_(m.weight)

    <span class="hljs-keyword">def</span> <span class="hljs-title function_">forward</span>(<span class="hljs-params">self, x</span>):
        <span class="hljs-keyword">return</span> self.ffn(x)
</code></pre>
<h3 id="patch-embedding">Patch Embedding</h3>
<p>Patch Embedding æ˜¯å°†å›¾åƒåˆ†å‰²æˆå¤šä¸ª patchï¼Œå¹¶å°†æ¯ä¸ª patch è½¬æ¢æˆä¸€ä¸ªç‰¹å¾å‘é‡ã€‚è¿™ä¸ªè¿‡ç¨‹å¯ä»¥é€šè¿‡ä¸€ä¸ªå·ç§¯å±‚æ¥å®ç°ã€‚</p>
<pre><code class="language-python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">VisionTransformer</span>(nn.Mudule):
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, ...</span>):
        self.patchify = nn.Conv2d(
            in_channels=in_channels,
            out_channels=d_model,
            kernel_size=patch_size,
            stride=patch_size,
            padding=<span class="hljs-number">0</span>,
            bias=<span class="hljs-literal">True</span>,
        )
</code></pre>
<h2 id="ç±»ä¸å‡è¡¡ç°è±¡çš„è§£å†³æ–¹æ¡ˆè¦æ±‚22å¿…åšéƒ¨åˆ†">ç±»ä¸å‡è¡¡ç°è±¡çš„è§£å†³æ–¹æ¡ˆï¼ˆè¦æ±‚2.2ï¼Œå¿…åšéƒ¨åˆ†ï¼‰</h2>
<h3 id="self-supervised-pre-training-ä»…ä½¿ç”¨è®­ç»ƒé›†ä¸æ·»åŠ æ–°æ•°æ®">Self-supervised pre-training ï¼ˆä»…ä½¿ç”¨è®­ç»ƒé›†ï¼Œä¸æ·»åŠ æ–°æ•°æ®ï¼‰</h3>
<p>æˆ‘ä»¬è®¾è®¡äº†ä¸€ä¸ªç®€å•çš„è‡ªç›‘ç£è®­ç»ƒç¼–è§£ç å™¨æ¨¡å—ï¼Œå…¶ä¸­ç¼–ç å™¨ä¸ºVitæ¶æ„ï¼Œè€Œè§£ç å™¨åˆ™ä½¿ç”¨äº†å·ç§¯å’Œåå·ç§¯ç¥ç»ç½‘ç»œã€‚æˆ‘ä»¬å°†ç¼–è§£ç å™¨æ¨¡å‹åœ¨è®­ç»ƒé›† <code>CIFAR10_imbalanced</code> è¿›è¡Œè‡ªç›‘ç£è®­ç»ƒï¼Œç„¶åå°†ç¼–ç å™¨çš„å‚æ•°è¿ç§»åˆ°åˆ†ç±»ä»»åŠ¡ä¸­ã€‚</p>
<p>å°† <code>VisionTransformer</code> çš„ç»“æ„åšå¦‚ä¸‹ä¿®æ”¹ï¼š</p>
<pre><code class="language-python">self.header = nn.Sequential(
    nn.Flatten(),
    nn.Linear(d_model * H * W, (d_model*H*W) // <span class="hljs-number">2</span>),
    nn.GELU(),
    nn.Linear((d_model*H*W) // <span class="hljs-number">2</span>, num_classes),
) <span class="hljs-keyword">if</span> classifier <span class="hljs-keyword">else</span> nn.Sequential(
    nn.ConvTranspose2d(d_model, in_channels,
        kernel_size=patch_size, stride=patch_size),
    nn.GELU(),
    nn.Conv2d(in_channels, in_channels,
        kernel_size=<span class="hljs-number">3</span>, padding=<span class="hljs-number">1</span>, stride=<span class="hljs-number">1</span>),
    nn.Tanh(),
)
</code></pre>
<p>å³å¯å¾—åˆ°ä¸€ä¸ªç®€å•çš„è‡ªç›‘ç£ç¼–ç å™¨ã€‚</p>
<p>å½“æˆ‘ä»¬è®­ç»ƒå¥½ç¼–ç å™¨åï¼Œæˆ‘ä»¬å°†å…¶å‚æ•°è¿ç§»åˆ°åˆ†ç±»ä»»åŠ¡ä¸­ã€‚åœ¨å¾®è°ƒçš„è¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬å°†ç¼–ç å™¨å‚æ•°çš„å­¦ä¹ ç‡è®¾ç½®ä¸ºåŸæ¥çš„ 1/100ï¼Œä»¥é˜²æ­¢è¿‡æ‹Ÿåˆã€‚</p>
<h3 id="data-augmentation">Data Augmentation</h3>
<p>æ•°æ®å¢å¼ºå¯¹äºç»å¤§éƒ¨åˆ†æ·±åº¦å­¦ä¹ ä»»åŠ¡æ¥è¯´ï¼Œå¯ä»¥åšåˆ°é˜²æ­¢è¿‡æ‹Ÿåˆçš„æ•ˆæœã€‚ä½†æ˜¯åœ¨æœ¬å®éªŒä¸­ï¼Œæˆ‘ä»¬å‘ç°ï¼Œè¿‡åˆ†çš„æ•°æ®å¢å¼ºä¼šå¯¼è‡´æ›´å¤§çš„è¿‡æ‹Ÿåˆç¨‹åº¦ã€‚å¯¹æ­¤ï¼Œæˆ‘ä»¬çš„è§£é‡Šæ˜¯ï¼š è®­ç»ƒé›† <code>CIFAR10_imbalanced</code> å’Œæµ‹è¯•é›† <code>CIFAR10_balance</code> çš„åˆ†å¸ƒå·®å¼‚è¿‡å¤§ï¼Œå¯¼è‡´æ¨¡å‹åœ¨è®­ç»ƒé›†ä¸Šçš„è¡¨ç°å¹¶ä¸èƒ½å¾ˆå¥½çš„æ³›åŒ–åˆ°æµ‹è¯•é›†ä¸Šã€‚</p>
<p>å› æ­¤ï¼Œåœ¨æœ¬å®éªŒä¸­ï¼Œæˆ‘ä»¬åªé€‰ç”¨äº†ä¸¤ç§ç®€å•çš„æ•°æ®å¢å¼ºæ–¹å¼ï¼šRandomHorizontalFlip å’Œ RandomCropã€‚</p>
<pre><code class="language-python">self.tf = transforms.Compose([
    transforms.Normalize(mean=(<span class="hljs-number">0.5</span>, <span class="hljs-number">0.5</span>, <span class="hljs-number">0.5</span>),
                    std=(<span class="hljs-number">0.5</span>, <span class="hljs-number">0.5</span>, <span class="hljs-number">0.5</span>)),
    transforms.RandomHorizontalFlip(),
    transforms.RandomResizedCrop((<span class="hljs-number">32</span>, <span class="hljs-number">32</span>), scale=(<span class="hljs-number">0.8</span>, <span class="hljs-number">1.0</span>),
                    ratio=(<span class="hljs-number">0.9</span>, <span class="hljs-number">1.1</span>), antialias=<span class="hljs-literal">None</span>),
])
</code></pre>
<p>æˆ‘ä»¬è¿˜å‘ç°ï¼Œå¦‚æœä½¿ç”¨äº† ColorJitter è¿™æ ·çš„æ•°æ®å¢å¼ºæ–¹å¼ï¼Œä¼šå¯¼è‡´æ¨¡å‹åœ¨è®­ç»ƒé›†ä¸Šçš„è¡¨ç°æ›´å·®ã€‚</p>
<h3 id="class-weighted-cross-entropy-loss">Class Weighted Cross Entropy Loss</h3>
<p>ç”±äºè®­ç»ƒé›† <code>CIFAR10_imbalanced</code> ä¸­çš„ç±»åˆ«åˆ†å¸ƒä¸å‡è¡¡ï¼Œè¿™ä¼šå¯¼è‡´æ¨¡å‹åœ¨è®­ç»ƒè¿‡ç¨‹ä¸­çš„æ¢¯åº¦æ›´åŠ åå‘äºä¼˜åŒ–æ•°é‡è¾ƒå¤šçš„ç±»åˆ«ã€‚ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬å°† Cross Entropy Loss çš„æƒé‡è®¾ç½®ä¸ºå„ä¸ªç±»åˆ«çš„å€’æ•°ã€‚å…·ä½“è€Œè¨€ï¼Œå¯¹äºç±»åˆ«ä¸º <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>i</mi></mrow><annotation encoding="application/x-tex">i</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6595em;"></span><span class="mord mathnormal">i</span></span></span></span> çš„æ ·æœ¬ï¼Œå…¶æƒé‡ä¸º <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mfrac><mi>N</mi><msub><mi>N</mi><mi>i</mi></msub></mfrac></mrow><annotation encoding="application/x-tex">N \over {N_i}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.3174em;vertical-align:-0.4451em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8723em;"><span style="top:-2.655em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.10903em;">N</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3281em;"><span style="top:-2.357em;margin-left:-0.109em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.143em;"><span></span></span></span></span></span></span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.394em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.10903em;">N</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.4451em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span>ã€‚å…¶ä¸­ <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>N</mi></mrow><annotation encoding="application/x-tex">N</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.10903em;">N</span></span></span></span> ä¸ºæ€»æ ·æœ¬æ•°ï¼Œ<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>N</mi><mi>i</mi></msub></mrow><annotation encoding="application/x-tex">N_i</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.10903em;">N</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:-0.109em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> ä¸ºç±»åˆ« <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>i</mi></mrow><annotation encoding="application/x-tex">i</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6595em;"></span><span class="mord mathnormal">i</span></span></span></span> çš„æ ·æœ¬æ•°ã€‚</p>
<pre><code class="language-python">cls_weight = torch.tensor([v <span class="hljs-keyword">for</span> (_, v) <span class="hljs-keyword">in</span> train_dataset.cls_cnt])
cls_weight = cls_weight.<span class="hljs-built_in">sum</span>() / cls_weight
cls_weight = cls_weight / cls_weight.<span class="hljs-built_in">sum</span>()
ce_loss_fn = torch.nn.CrossEntropyLoss(cls_weight.to(train_cfg.device))
</code></pre>
<h3 id="online-hard-example-mining">Online Hard Example Mining</h3>
<p>è¿™ä¸ªåå­—ä¸€å¬èµ·æ¥å°±å¾ˆé«˜å¤§ä¸Šï¼Œä½†å®é™…ä¸Šå°±æ˜¯åœ¨è®­ç»ƒè¿‡ç¨‹ä¸­ç­›é€‰éƒ¨åˆ†æ¯”è¾ƒéš¾åˆ†ç±»çš„æ ·æœ¬ï¼Œå¹¶ä»…ä»…ä½¿ç”¨è¿™éƒ¨åˆ†æ ·æœ¬è¿›è¡Œåå‘ä¼ æ’­ï¼Œä¼˜åŒ–ç½‘ç»œå‚æ•°ã€‚é‚£ä¹ˆæ€ä¹ˆé€‰å‡ºè¿™éƒ¨åˆ†æ ·æœ¬å‘¢ï¼Ÿå¯¹äºåˆ†ç±»é—®é¢˜æ¥è¯´ï¼Œåªéœ€è¦åˆ¤æ–­æŸä¸ªæ ·æœ¬çš„åˆ†ç±»æŸå¤±å³å¯ã€‚ä»£ç å¦‚ä¸‹ï¼š</p>
<pre><code class="language-python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">OHEM_CELoss</span>(nn.Module):
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, ratio=<span class="hljs-number">0.5</span>, **kwargs</span>):
        <span class="hljs-built_in">super</span>().__init__()
        self.ratio = ratio
        self.loss_fn = nn.CrossEntropyLoss(reduction=<span class="hljs-string">&#x27;none&#x27;</span>, **kwargs)

    <span class="hljs-keyword">def</span> <span class="hljs-title function_">forward</span>(<span class="hljs-params">self, pred, target</span>):
        loss = self.loss_fn(pred, target)
        num = <span class="hljs-built_in">int</span>(self.ratio * loss.size(<span class="hljs-number">0</span>))
        loss, _ = loss.topk(num)
        <span class="hljs-keyword">return</span> loss.mean()
</code></pre>
<h3 id="æ•´ä½“æ•ˆæœ">æ•´ä½“æ•ˆæœ</h3>
<table>
<thead>
<tr>
<th style="text-align:center">Vanilla Algorithm</th>
<th style="text-align:center">Improved Algorithm</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center"><img src="file:////data2/nyw/study/dlcv/report3/image/report3/vanilla_alg.png" alt="vanilla_alg"></td>
<td style="text-align:center"><img src="file:////data2/nyw/study/dlcv/report3/image/report3/improved.png" alt="improved_alg"></td>
</tr>
</tbody>
</table>
<p>[ğŸ’¡]å¯¹æ•ˆæœæå‡æœ€æ˜æ˜¾çš„æ”¹å–„æ–¹æ³•å®é™…ä¸Šæ˜¯ Self-Supvised Pre-trainingï¼Œå¯èƒ½æ˜¯å› ä¸ºè‡ªç›‘ç£çš„è¿‡ç¨‹å®é™…ä¸Šæ˜¯ class-free çš„ã€‚åŒæ—¶ï¼ŒVitæ¡†æ¶ä¸‹çš„è‡ªç›‘ç£è®­ç»ƒå¯ä»¥è®©æ¨¡å‹å­¦ä¼šåŒºåˆ†ä¸åŒçš„â€œå­å›¾â€ï¼Œè¿™æ—¶å› ä¸ºAttentionä½œä¸ºå…¶æ ¸å¿ƒæ¨¡å—ï¼Œä»æœ¬è´¨ä¸Šæ¥è¯´å®åœ¨è®¡ç®—åŒä¸€å¼ å›¾åƒä¸åŒå­å›¾ä¹‹é—´çš„è‡ªç›¸å…³å…³ç³»ã€‚ç›¸ä¼¼æ€§å¤§çš„å­å›¾ï¼Œå…¶ç‰¹å¾å‘é‡çš„å¤¹è§’ä¼šæ¯”è¾ƒå°ï¼Œç›¸ä¼¼æ€§å°çš„å­å›¾ï¼Œå…¶ç‰¹å¾å‘é‡çš„å¤¹è§’ä¼šæ¯”è¾ƒå¤§ã€‚è‡ªç›‘ç£çš„å­¦ä¹ å¯ä»¥è®©æ¨¡å‹å­¦ä¼šåŒºåˆ†ä¸åŒçš„å›¾åƒéƒ¨åˆ†ï¼Œè¿™ä¸è‡ªç„¶è¯­è¨€å¤„ç†çš„é¢„è®­ç»ƒæœ‰ç€å¼‚æ›²åŒå·¥ä¹‹å¦™ã€‚</p>
<h2 id="åˆ†ævitä¸åŒæ¨¡å—å¯¹åˆ†ç±»ç»“æœçš„å½±å“è¦æ±‚23å¿…åšéƒ¨åˆ†">åˆ†æViTä¸åŒæ¨¡å—å¯¹åˆ†ç±»ç»“æœçš„å½±å“ï¼ˆè¦æ±‚2.3ï¼Œå¿…åšéƒ¨åˆ†ï¼‰</h2>
<h3 id="é»˜è®¤å®éªŒè®¾ç½®">é»˜è®¤å®éªŒè®¾ç½®</h3>
<p>ä¸ºäº†æ–¹ä¾¿æè¿°ï¼Œä»¥ä¸‹æ¯ä¸ªå®éªŒä»…æ”¹å˜ä¸€ä¸ªè¶…å‚æ•°ï¼Œå…¶ä»–è¶…å‚æ•°ä¿æŒä¸å˜ã€‚é»˜è®¤å®éªŒè®¾ç½®å¦‚ä¸‹ï¼š</p>
<pre><code class="language-python"><span class="hljs-meta">@dataclass</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">ModelConfig</span>:
    <span class="hljs-string">&quot;&quot;&quot;Vit Model configuration&quot;&quot;&quot;</span>
    num_classes: <span class="hljs-built_in">int</span> = <span class="hljs-number">10</span>
    in_channels: <span class="hljs-built_in">int</span> = <span class="hljs-number">3</span>
    img_size: <span class="hljs-built_in">tuple</span>[<span class="hljs-built_in">int</span>, <span class="hljs-built_in">int</span>] = (<span class="hljs-number">32</span>, <span class="hljs-number">32</span>)
    patch_size: <span class="hljs-built_in">int</span> = <span class="hljs-number">4</span>
    d_model: <span class="hljs-built_in">int</span> = <span class="hljs-number">256</span>
    num_heads: <span class="hljs-built_in">int</span> = <span class="hljs-number">4</span>
    num_layers: <span class="hljs-built_in">int</span> = <span class="hljs-number">6</span>
    ffn_hidden_channels: <span class="hljs-built_in">int</span> = <span class="hljs-number">512</span>
    dropout: <span class="hljs-built_in">float</span> = <span class="hljs-number">0.1</span>
    classifier: <span class="hljs-built_in">bool</span> = <span class="hljs-literal">True</span>
</code></pre>
<h3 id="patch-sizeçš„å½±å“">Patch Sizeçš„å½±å“</h3>
<p>æˆ‘ä»¬åˆ†åˆ«ä½¿ç”¨äº† <code>patch_size=4</code> ã€ <code>patch_size=8</code> å’Œ <code>patch_size=16</code> ä¸‰ç§ä¸åŒçš„ patch size è¿›è¡Œå®éªŒï¼Œå¾—åˆ°äº†å¦‚ä¸‹çš„ç»“æœï¼š</p>
<table>
<thead>
<tr>
<th style="text-align:center">Patch Size = 4</th>
<th style="text-align:center">Patch Size = 8</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center"><img src="file:////data2/nyw/study/dlcv/report3/image/report3/ps_4.png" alt="ps_4"></td>
<td style="text-align:center"><img src="file:////data2/nyw/study/dlcv/report3/image/report3/ps_8.png" alt="ps_8"></td>
</tr>
</tbody>
</table>
<table>
<thead>
<tr>
<th style="text-align:center">Patch Size = 16</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center"><img src="file:////data2/nyw/study/dlcv/report3/image/report3/ps_16.png" alt="ps_16"></td>
</tr>
</tbody>
</table>
<p>å¯ä»¥çœ‹åˆ°ï¼Œå½“ Patch Size ä¸º 16 æ—¶ï¼Œæ¨¡å‹çš„è¡¨ç°éª¤é™ï¼Œè¿™æ˜¯å› ä¸º Patch Size è¿‡å¤§ï¼Œå¯¼è‡´äº†æ¨¡å‹æ— æ³•æ•æ‰åˆ°å›¾åƒä¸­çš„ç»†èŠ‚ä¿¡æ¯ã€‚</p>
<h3 id="embedding-dimension-çš„å½±å“">Embedding Dimension çš„å½±å“</h3>
<p>æˆ‘ä»¬åˆ†åˆ«å°è¯•äº† <code>d_model=64</code> ã€ <code>d_model=128</code> ã€ <code>d_model=256</code> å’Œ <code>d_model=512</code> å››ç§ä¸åŒçš„ embedding dimension è¿›è¡Œå®éªŒï¼Œå¾—åˆ°äº†å¦‚ä¸‹çš„ç»“æœï¼š</p>
<table>
<thead>
<tr>
<th style="text-align:center">d_model = 64</th>
<th style="text-align:center">d_model = 128</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center"><img src="file:////data2/nyw/study/dlcv/report3/image/report3/d_64.png" alt="d_128"></td>
<td style="text-align:center"><img src="file:////data2/nyw/study/dlcv/report3/image/report3/d_128.png" alt="d_256"></td>
</tr>
</tbody>
</table>
<table>
<thead>
<tr>
<th style="text-align:center">d_model = 256</th>
<th style="text-align:center">d_model = 512</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center"><img src="file:////data2/nyw/study/dlcv/report3/image/report3/d_256.png" alt="d_512"></td>
<td style="text-align:center"><img src="file:////data2/nyw/study/dlcv/report3/image/report3/d_512.png" alt="d_1024"></td>
</tr>
</tbody>
</table>
<p>å¯ä»¥çœ‹åˆ°ï¼Œéšç€ embedding dimension çš„å¢å¤§ï¼Œæ¨¡å‹çš„è¡¨ç°é€æ¸æå‡ã€‚ååˆ†å¯æƒœçš„æ˜¯ï¼Œæˆ‘åªæœ‰ 24G çš„æ˜¾å­˜èµ„æºï¼Œæ— æ³•å°è¯•æ›´å¤§çš„ embedding dimensionã€‚</p>
<h3 id="number-of-heads-çš„å½±å“">Number of Heads çš„å½±å“</h3>
<p>æˆ‘ä»¬åˆ†åˆ«å°è¯•äº† <code>num_heads=2</code> ã€ <code>num_heads=4</code> ã€ <code>num_heads=8</code> å’Œ <code>num_heads=16</code> å››ç§ä¸åŒçš„ head æ•°ç›®è¿›è¡Œå®éªŒï¼Œå¾—åˆ°äº†å¦‚ä¸‹çš„ç»“æœï¼š</p>
<table>
<thead>
<tr>
<th style="text-align:center">num_heads = 2</th>
<th style="text-align:center">num_heads = 4</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center"><img src="file:////data2/nyw/study/dlcv/report3/image/report3/nh_2.png" alt="nh_2"></td>
<td style="text-align:center"><img src="file:////data2/nyw/study/dlcv/report3/image/report3/nh_4.png" alt="nh_4"></td>
</tr>
</tbody>
</table>
<table>
<thead>
<tr>
<th style="text-align:center">num_heads = 8</th>
<th style="text-align:center">num_heads = 16</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center"><img src="file:////data2/nyw/study/dlcv/report3/image/report3/nh_8.png" alt="nh_8"></td>
<td style="text-align:center"><img src="file:////data2/nyw/study/dlcv/report3/image/report3/nh_16.png" alt="nh_16"></td>
</tr>
</tbody>
</table>
<p>å¯ä»¥å‘ç°ï¼Œåœ¨ num_heads = 8 æ—¶ï¼Œæ¨¡å‹çš„è¡¨ç°è¾¾åˆ°äº†æœ€å¥½ã€‚è¿‡å¤§/è¿‡å°çš„ num_heads éƒ½ä¼šå¯¼è‡´æ¨¡å‹çš„è¡¨ç°ä¸‹é™ã€‚</p>
<h2 id="vitè½»é‡åŒ–è¦æ±‚24é€‰åšéƒ¨åˆ†">ViTè½»é‡åŒ–ï¼ˆè¦æ±‚2.4ï¼Œé€‰åšéƒ¨åˆ†ï¼‰</h2>
<p>ViTï¼ˆVision Transformerï¼‰è½»é‡åŒ–çš„ä¸»è¦ç›®æ ‡æ˜¯å‡å°‘æ¨¡å‹çš„å‚æ•°å’Œè®¡ç®—å¤æ‚åº¦ï¼ŒåŒæ—¶ä¿æŒæ€§èƒ½ã€‚é€šè¿‡æŠ€æœ¯å¦‚çŸ¥è¯†è’¸é¦ã€æƒé‡å‰ªæå’Œæ¨¡å‹é‡åŒ–ï¼ŒViTå¯ä»¥åœ¨ç§»åŠ¨è®¾å¤‡å’Œè¾¹ç¼˜è®¡ç®—ä¸­æ›´æœ‰æ•ˆåœ°è¿è¡Œã€‚è½»é‡åŒ–ç‰ˆæœ¬é€šå¸¸é‡‡ç”¨æ›´å°çš„è¾“å…¥åˆ†è¾¨ç‡å’Œå‡å°‘å±‚æ•°ï¼Œç¡®ä¿åœ¨èµ„æºæœ‰é™çš„æƒ…å†µä¸‹ä»èƒ½æä¾›å‡ºè‰²çš„è§†è§‰è¯†åˆ«èƒ½åŠ›ã€‚è¿™ç§æ–¹æ³•è®©ViTåœ¨å¤„ç†å¤æ‚å›¾åƒä»»åŠ¡æ—¶ï¼Œå…¼é¡¾æ•ˆç‡ä¸æ•ˆæœã€‚</p>
<p>xFormersæ˜¯ä¸€ä¸ªæ—¨åœ¨åŠ é€ŸTransformerç›¸å…³ç ”ç©¶çš„å·¥å…·ç®±ï¼Œæä¾›äº†ä¸€ç³»åˆ—å¯å®šåˆ¶çš„æ„å»ºæ¨¡å—ã€‚è¿™äº›æ¨¡å—ç‹¬ç«‹ä¸”å¯è‡ªå®šä¹‰ï¼Œæ— éœ€ç¹ççš„ä»£ç ï¼Œä½¿å¾—ç ”ç©¶äººå‘˜å¯ä»¥æ–¹ä¾¿åœ°åœ¨è§†è§‰ã€è‡ªç„¶è¯­è¨€å¤„ç†ç­‰å¤šä¸ªé¢†åŸŸä¸­åº”ç”¨ã€‚xFormerså…³æ³¨å‰æ²¿ç ”ç©¶ï¼ŒåŒ…å«è®¸å¤šå°šæœªåœ¨ä¸»æµåº“ï¼ˆå¦‚PyTorchï¼‰ä¸­å®ç°çš„æœ€æ–°ç»„ä»¶ã€‚æ­¤å¤–ï¼ŒxFormersç‰¹åˆ«æ³¨é‡æ•ˆç‡ï¼Œæ‰€æœ‰ç»„ä»¶éƒ½ç»è¿‡ä¼˜åŒ–ï¼Œä»¥ç¡®ä¿å¿«é€Ÿçš„è¿­ä»£é€Ÿåº¦å’Œè‰¯å¥½çš„å†…å­˜åˆ©ç”¨ç‡ã€‚å®ƒè¿˜é›†æˆäº†è‡ªå®šä¹‰CUDAå†…æ ¸ï¼Œå¹¶åœ¨å¿…è¦æ—¶è°ƒç”¨å…¶ä»–åº“ï¼Œä»è€Œè¿›ä¸€æ­¥æå‡æ€§èƒ½ã€‚</p>

            <script async src="https://cdn.jsdelivr.net/npm/katex-copytex@latest/dist/katex-copytex.min.js"></script>
            
        </body>
        </html>